{"ast":null,"code":"import _slicedToArray from \"/Users/anujwagle/Desktop/temp/datapali-dashboard/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _defineProperty from \"/Users/anujwagle/Desktop/temp/datapali-dashboard/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/anujwagle/Desktop/temp/datapali-dashboard/src/components/SurveyForm.tsx\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState } from \"react\";\nimport { QAQuestion } from \"../form/question\";\nimport { Classes, Button as Button_B, Tree, ButtonGroup, Collapse } from \"@blueprintjs/core\";\nimport { DPFormItem } from \"./DPFormItem\";\nimport { getRandomId } from \"../utils/getRandomId\";\nimport { Row, Badge } from \"reactstrap\";\nimport { Toolbar } from \"./Toolbar\";\nimport { testQuestion, testQuestion2, testQuestion3, testQuestion4, testQuestion5 } from \"../testData/TestQuestions\";\nimport _ from \"lodash\";\nexport class SurveyForm {\n  constructor() {\n    this.content = void 0;\n    this.id = void 0;\n    this.name = void 0;\n    this.id = getRandomId(\"sf-\");\n  }\n\n  setName(name) {\n    this.name = name;\n    return this;\n  }\n\n  setContent(content) {\n    this.content = content;\n    return this;\n  }\n\n  addContent(content) {\n    this.content.push(content);\n    return this;\n  }\n\n}\nexport class QuestionSection {\n  constructor() {\n    this.name = void 0;\n    this.content = void 0;\n    this.id = void 0;\n    this.id = getRandomId(\"ss-\");\n    this.content = [];\n  }\n\n  setID(id) {\n    this.id = id;\n    return this;\n  }\n\n  setName(name) {\n    this.name = name;\n    return this;\n  }\n\n  setContent(content) {\n    this.content = content;\n    return this;\n  }\n\n  addContent(content) {\n    this.content.push(content);\n    return this;\n  }\n\n  deleteContent(contentId) {\n    let found = this.content.findIndex(item => item.id === contentId);\n\n    if (found > -1) {\n      this.content.splice(found, 1);\n    }\n  }\n\n}\nconst TreeF = Tree.ofType();\nexport class SurveyForm_ extends React.Component {\n  static questionOrSectionFromPath(path, root) {\n    let el = root[path[0]];\n\n    if (path.length === 1) {\n      return el;\n    } else {\n      return SurveyForm_.questionOrSectionFromPath(path.slice(1), el.content);\n    }\n  }\n\n  constructor(props) {\n    super(props);\n    this.state = {\n      form: this.props.form,\n      activeSection: this.props.form,\n      treeNodes: this.generateITNodeTree(this.props.form),\n      activeSectionPath: [0]\n    };\n  }\n\n  getNodeFromQuestionOrSection(item, sectionNumber) {\n    let def = {\n      id: item.id,\n      icon: undefined,\n      label: \"\"\n    };\n\n    if (item instanceof QAQuestion) {\n      def.icon = \"document\";\n      def.label = sectionNumber + \" \" + \"Question\";\n    } else if (item instanceof QuestionSection) {\n      def.icon = \"folder-close\";\n      def.label = sectionNumber + \" \" + (item.name || \"Section\");\n      def.childNodes = item.content.map((it, ind) => this.getNodeFromQuestionOrSection(it, sectionNumber + \".\" + (ind + 1)));\n    }\n\n    return def;\n  }\n\n  generateITNodeTree(form) {\n    let root = {\n      id: 0,\n      hasCaret: true,\n      icon: \"folder-close\",\n      label: form.name,\n      isExpanded: true,\n      childNodes: form.content.map((it, ind) => this.getNodeFromQuestionOrSection(it, (ind + 1).toString()))\n    };\n    return [root];\n  }\n\n  addSectionToNodeTree(_nodePath, section) {\n    let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n\n    if (node.childNodes) {\n      let readablePath = getReadablePath(this.state.activeSectionPath);\n      if (readablePath) readablePath += \".\";\n      node.childNodes.push(this.getNodeFromQuestionOrSection(section, readablePath + (node.childNodes.length + 1).toString()));\n    }\n\n    return this.state;\n  }\n\n  deleteNodeFromNodeTree(_nodePath, id) {\n    let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n\n    if (node.childNodes) {\n      let foundIndex = node.childNodes.findIndex(item => item.id === id);\n\n      if (foundIndex > -1) {\n        node.childNodes.splice(foundIndex, 1);\n      }\n    }\n\n    return this.state;\n  }\n\n  addQuestionToNodeTree(_nodePath, section) {\n    let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n\n    if (node.childNodes) {\n      let readablePath = getReadablePath(this.state.activeSectionPath);\n      if (readablePath) readablePath += \".\";\n      node.childNodes.push(this.getNodeFromQuestionOrSection(section, readablePath + (node.childNodes.length + 1).toString()));\n    }\n\n    return this.state;\n  }\n\n  handleChange(section) {\n    this.setState(prevState => {\n      return {\n        form: section\n      };\n    }, () => {\n      if (this.props.onChange) this.props.onChange(this.state.form);\n    });\n  }\n\n  handleAddSection() {\n    this.setState(prevState => {\n      let cloned = _.clone(prevState.form);\n\n      let toAddIn = SurveyForm_.questionOrSectionFromPath(this.state.activeSectionPath, [cloned]);\n\n      if (toAddIn instanceof QAQuestion) {\n        return {};\n      }\n\n      let newsection = new QuestionSection();\n      toAddIn.addContent(new QuestionSection());\n      this.addSectionToNodeTree(this.state.activeSectionPath, newsection);\n      return _objectSpread({}, this.state, {\n        form: cloned\n      });\n    }, () => {\n      if (this.props.onChange) this.props.onChange(this.state.form);\n    });\n  }\n\n  handleAddQuestion() {\n    this.setState(prevState => {\n      let cloned = _.clone(prevState.form);\n\n      let toAddIn = SurveyForm_.questionOrSectionFromPath(this.state.activeSectionPath, [cloned]);\n\n      if (toAddIn instanceof QAQuestion) {\n        return {};\n      }\n\n      let q = new QAQuestion();\n      toAddIn.addContent(new QAQuestion());\n      this.addQuestionToNodeTree(this.state.activeSectionPath, q);\n      return _objectSpread({}, this.state, {\n        form: cloned\n      });\n    }, () => {\n      if (this.props.onChange) this.props.onChange(this.state.form);\n    });\n  }\n\n  handleDeleteQuestionOrSection(deleteid) {\n    this.setState(prevState => {\n      let cloned = _.clone(prevState.form);\n\n      cloned.deleteContent(deleteid);\n      this.deleteNodeFromNodeTree(this.state.activeSectionPath, deleteid);\n      return _objectSpread({}, this.state, {\n        form: cloned\n      });\n    }, () => {\n      if (this.props.onChange) this.props.onChange(this.state.form);\n    });\n  }\n\n  handleToolbarItemClick(name) {\n    switch (name) {\n      case \"add-section\":\n        this.handleAddSection();\n        break;\n\n      case \"add-question\":\n        this.handleAddQuestion();\n        break;\n    }\n  }\n\n  handleQuestionUpdate(question) {\n    this.setState(prevState => {\n      let cloned = _.clone(prevState.form);\n\n      let foundQ = cloned.content.find(item => item.id === question.id);\n\n      if (foundQ && foundQ instanceof QAQuestion) {\n        foundQ.updateFromQuestion(question);\n      }\n\n      return {\n        form: cloned\n      };\n    }, () => {\n      if (this.props.onChange) this.props.onChange(this.state.form);\n    });\n  }\n\n  forEachNode(nodes, callback) {\n    if (nodes == null) {\n      return;\n    }\n\n    for (const node of nodes) {\n      callback(node);\n      if (node.childNodes) this.forEachNode(node.childNodes, callback);\n    }\n  }\n\n  handleFormTreeNodeExpand(nodeData) {\n    nodeData.isExpanded = true;\n    this.setState(this.state);\n  }\n\n  handleFormTreeNodeCollapse(nodeData) {\n    nodeData.isExpanded = false;\n    this.setState(this.state);\n  }\n\n  handleFormTreeNodeClick(nodeData, _nodePath, e) {\n    console.log(_nodePath);\n    const initiallySelected = !!nodeData.isSelected;\n\n    if (!e.shiftKey) {\n      this.forEachNode(this.state.treeNodes, n => n.isSelected = false);\n    }\n\n    nodeData.isSelected = !initiallySelected;\n    let item = SurveyForm_.questionOrSectionFromPath(_nodePath, [this.state.form]);\n    console.log(item);\n\n    if (item instanceof QuestionSection) {\n      this.setState(prevState => {\n        return _objectSpread({}, this.state, {\n          activeSection: item instanceof QuestionSection ? item : prevState.activeSection,\n          activeSectionPath: _nodePath\n        });\n      });\n    }\n  }\n\n  render() {\n    return React.createElement(Row, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 322\n      },\n      __self: this\n    }, React.createElement(Toolbar, {\n      handleItemClick: this.handleToolbarItemClick.bind(this),\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      className: \"container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        background: \"transparent\"\n      },\n      className: \"sidebar\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 326\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"sidebar-wrapper\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 327\n      },\n      __self: this\n    }, React.createElement(FormTree, {\n      handleNodeExpand: this.handleFormTreeNodeExpand.bind(this),\n      handleNodeCollapse: this.handleFormTreeNodeCollapse.bind(this),\n      handleNodeClick: this.handleFormTreeNodeClick.bind(this),\n      nodes: this.state.treeNodes,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 328\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"content\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 331\n      },\n      __self: this\n    }, React.createElement(SectionC, {\n      handleDeleteChildSectionOrQuestion: this.handleDeleteQuestionOrSection.bind(this),\n      parentPath: this.state.activeSectionPath,\n      handleQuestionChange: this.handleQuestionUpdate.bind(this),\n      section: this.state.activeSection,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 332\n      },\n      __self: this\n    })), React.createElement(Row, {\n      style: {\n        position: \"fixed\",\n        height: \"60px\",\n        bottom: 0,\n        width: \"100%\",\n        margin: \"0 auto\"\n      },\n      className: \"fixed-footer\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334\n      },\n      __self: this\n    })));\n  }\n\n}\nSurveyForm_.defaultProps = {\n  form: new QuestionSection().setContent([testQuestion, testQuestion2, testQuestion3, new QuestionSection().setContent([testQuestion4, testQuestion5]).setName(\"true things\")])\n};\nexport class FormTree extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.handleNodeClick = (nodeData, _nodePath, e) => {\n      if (this.props.handleNodeClick) this.props.handleNodeClick(nodeData, _nodePath, e);\n    };\n\n    this.handleNodeCollapse = nodeData => {\n      if (this.props.handleNodeCollapse) this.props.handleNodeCollapse(nodeData);\n    };\n\n    this.handleNodeExpand = nodeData => {\n      if (this.props.handleNodeExpand) this.props.handleNodeExpand(nodeData);\n    };\n\n    this.state = {};\n  }\n\n  render() {\n    return React.createElement(Tree, {\n      contents: this.props.nodes,\n      onNodeClick: this.handleNodeClick,\n      onNodeCollapse: this.handleNodeCollapse,\n      onNodeExpand: this.handleNodeExpand,\n      className: Classes.ELEVATION_0,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 380\n      },\n      __self: this\n    });\n  }\n\n}\n\nclass SectionC extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  handleQuestionChange(q) {\n    if (this.props.handleQuestionChange) this.props.handleQuestionChange(q);\n  }\n\n  render() {\n    let comp = null;\n    let readablePath = getReadablePath(this.props.parentPath);\n    if (readablePath) readablePath += \".\";\n    comp = this.props.section.content.map((item, index) => {\n      if (item instanceof QAQuestion) {\n        return React.createElement(QuestionButton, {\n          questionId: item.id,\n          handleDeletion: this.props.handleDeleteChildSectionOrQuestion,\n          path: readablePath + (index + 1),\n          key: item.id,\n          isExpanded: false,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 415\n          },\n          __self: this\n        }, React.createElement(DPFormItem, {\n          onChange: this.handleQuestionChange.bind(this),\n          question: item,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 416\n          },\n          __self: this\n        }));\n      } else if (item instanceof QuestionSection) {\n        return React.createElement(SectionButton, {\n          handleDeletion: this.props.handleDeleteChildSectionOrQuestion,\n          sectionId: item.id,\n          path: readablePath + (index + 1),\n          key: item.id,\n          onClick: () => console.log(\"Sdf\"),\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 420\n          },\n          __self: this\n        });\n      }\n    });\n    return React.createElement(ButtonGroup, {\n      fill: true,\n      vertical: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 424\n      },\n      __self: this\n    }, comp);\n  }\n\n}\n\nconst QuestionButton = props => {\n  const _useState = useState(false),\n        _useState2 = _slicedToArray(_useState, 2),\n        isExpanded = _useState2[0],\n        setIsExpanded = _useState2[1];\n\n  return React.createElement(ButtonGroup, {\n    className: \"bp3-dark\",\n    style: {\n      paddingBottom: \"20px\"\n    },\n    fill: true,\n    vertical: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 442\n    },\n    __self: this\n  }, React.createElement(ButtonGroup, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443\n    },\n    __self: this\n  }, React.createElement(Button_B, {\n    style: {\n      height: 50\n    },\n    onClick: () => setIsExpanded(!isExpanded),\n    alignText: \"left\",\n    rightIcon: isExpanded ? \"chevron-up\" : \"chevron-down\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444\n    },\n    __self: this\n  }, React.createElement(Badge, {\n    color: \"secondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444\n    },\n    __self: this\n  }, \"Q\"), \" \", React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444\n    },\n    __self: this\n  }, props.path + \" Question\", \" \")), React.createElement(Button_B, {\n    onClick: () => props.handleDeletion(props.questionId),\n    style: {\n      height: 50,\n      width: 20\n    },\n    alignText: \"left\",\n    rightIcon: \"cross\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 445\n    },\n    __self: this\n  })), React.createElement(Collapse, {\n    keepChildrenMounted: false,\n    isOpen: isExpanded,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 447\n    },\n    __self: this\n  }, props.children));\n};\n\nconst SectionButton = props => {\n  return React.createElement(ButtonGroup, {\n    className: \"bp3-dark\",\n    style: {\n      paddingBottom: \"20px\"\n    },\n    fill: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 463\n    },\n    __self: this\n  }, React.createElement(Button_B, {\n    style: {\n      height: 50\n    },\n    alignText: \"left\",\n    onClick: props.onClick,\n    rightIcon: \"folder-open\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464\n    },\n    __self: this\n  }, React.createElement(Badge, {\n    color: \"secondary\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464\n    },\n    __self: this\n  }, \"S\"), \" \", React.createElement(\"span\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 464\n    },\n    __self: this\n  }, props.path + \" Section\", \" \")), React.createElement(Button_B, {\n    onClick: () => props.handleDeletion(props.sectionId),\n    style: {\n      height: 50,\n      width: 20\n    },\n    alignText: \"left\",\n    rightIcon: \"cross\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 465\n    },\n    __self: this\n  }));\n};\n\nfunction getReadablePath(nu) {\n  return nu.slice(1).map(item => item + 1).join(\".\");\n}\n\nclass EditView extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {};\n  }\n\n  handleSectionAdd() {}\n\n  handleQuestionAdd() {}\n\n  handleSectionRemove() {}\n\n  handleQuestionRemove() {}\n\n  handleMoveItem(previousPath, newPath) {}\n\n  render() {\n    return React.createElement(React.Fragment, null);\n  }\n\n}","map":{"version":3,"sources":["/Users/anujwagle/Desktop/temp/datapali-dashboard/src/components/SurveyForm.tsx"],"names":["React","useState","QAQuestion","Classes","Button","Button_B","Tree","ButtonGroup","Collapse","DPFormItem","getRandomId","Row","Badge","Toolbar","testQuestion","testQuestion2","testQuestion3","testQuestion4","testQuestion5","_","SurveyForm","constructor","content","id","name","setName","setContent","addContent","push","QuestionSection","setID","deleteContent","contentId","found","findIndex","item","splice","TreeF","ofType","SurveyForm_","Component","questionOrSectionFromPath","path","root","el","length","slice","props","state","form","activeSection","treeNodes","generateITNodeTree","activeSectionPath","getNodeFromQuestionOrSection","sectionNumber","def","icon","undefined","label","childNodes","map","it","ind","hasCaret","isExpanded","toString","addSectionToNodeTree","_nodePath","section","node","nodeFromPath","readablePath","getReadablePath","deleteNodeFromNodeTree","foundIndex","addQuestionToNodeTree","handleChange","setState","prevState","onChange","handleAddSection","cloned","clone","toAddIn","newsection","handleAddQuestion","q","handleDeleteQuestionOrSection","deleteid","handleToolbarItemClick","handleQuestionUpdate","question","foundQ","find","updateFromQuestion","forEachNode","nodes","callback","handleFormTreeNodeExpand","nodeData","handleFormTreeNodeCollapse","handleFormTreeNodeClick","e","console","log","initiallySelected","isSelected","shiftKey","n","render","bind","background","position","height","bottom","width","margin","defaultProps","FormTree","handleNodeClick","handleNodeCollapse","handleNodeExpand","ELEVATION_0","SectionC","handleQuestionChange","comp","parentPath","index","handleDeleteChildSectionOrQuestion","QuestionButton","setIsExpanded","paddingBottom","handleDeletion","questionId","children","SectionButton","onClick","sectionId","nu","join","EditView","handleSectionAdd","handleQuestionAdd","handleSectionRemove","handleQuestionRemove","handleMoveItem","previousPath","newPath"],"mappings":"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","sourcesContent":["import React, { ReactNode, useState } from \"react\";\nimport { QAQuestion } from \"../form/question\";\nimport { Classes, Button as Button_B, Icon, Intent, ITreeNode, Position, Tooltip, Tree, ButtonGroup, Collapse, IconName, Pre } from \"@blueprintjs/core\";\nimport { DPFormItem } from \"./DPFormItem\";\nimport { getRandomId } from \"../utils/getRandomId\";\nimport { AnswerType, QAType } from \"../form/answer\";\nimport { Row, Col, Button, Label, Badge } from \"reactstrap\";\nimport { Toolbar } from \"./Toolbar\";\nimport { ALIGNMENT_LEFT } from \"@blueprintjs/icons/lib/esm/generated/iconNames\";\nimport { ANSWER_TYPES, QAValueType } from \"./AnswerType\";\nimport { testQuestion, testQuestion2, testQuestion3, testQuestion4, testQuestion5 } from \"../testData/TestQuestions\";\nimport _ from \"lodash\";\n\nexport class SurveyForm {\n    content!: (QuestionSection | QAQuestion)[];\n    id: string;\n    name!: string;\n    constructor() {\n        this.id = getRandomId(\"sf-\");\n    }\n    setName(name: string) {\n        this.name = name;\n        return this;\n    }\n\n    setContent(content: (QuestionSection | QAQuestion)[]) {\n        this.content = content;\n        return this;\n    }\n\n    addContent(content: QAQuestion | QuestionSection) {\n        this.content.push(content);\n        return this;\n    }\n\n}\n\nexport class QuestionSection {\n    name!: string;\n    content!: (QuestionSection | QAQuestion)[]\n    id: string\n    constructor() {\n        this.id = getRandomId(\"ss-\");\n        this.content = []\n\n    }\n    setID(id: string) {\n        this.id = id;\n        return this;\n    }\n    setName(name: string) {\n        this.name = name;\n        return this;\n    }\n    setContent(content: (QuestionSection | QAQuestion)[]) {\n        this.content = content;\n        return this;\n    }\n\n    addContent(content: QuestionSection | QAQuestion) {\n        this.content.push(content);\n        return this;\n    }\n\n    deleteContent(contentId: string) {\n        let found = this.content.findIndex(item => item.id === contentId);\n        if (found > -1) {\n            this.content.splice(found, 1);\n        }\n    }\n}\n\ninterface SurveyFormState {\n    form: QuestionSection,\n    activeSection: QuestionSection,\n    activeSectionPath: number[]\n    treeNodes: ITreeNode[],\n\n}\ninterface SurveyFormProps {\n    form: QuestionSection,\n    onChange: (form: QuestionSection) => void\n}\n\n\nconst TreeF = Tree.ofType<QuestionSection>();\n\n\nexport class SurveyForm_ extends React.Component<SurveyFormProps, SurveyFormState>{\n    static defaultProps = {\n        form: new QuestionSection().setContent([testQuestion, testQuestion2, testQuestion3, new QuestionSection().setContent([testQuestion4, testQuestion5]).setName(\"true things\")]),\n    }\n    public static questionOrSectionFromPath(path: number[], root: (QuestionSection | QAQuestion)[]): QuestionSection | QAQuestion {\n        let el = root[path[0]];\n        if (path.length === 1) {\n            return el;\n        } else {\n            return SurveyForm_.questionOrSectionFromPath(path.slice(1), el.content);\n        }\n    }\n    constructor(props: SurveyFormProps) {\n        super(props);\n        this.state = {\n            form: this.props.form,\n            activeSection: this.props.form,\n            treeNodes: this.generateITNodeTree(this.props.form),\n            activeSectionPath: [0]\n        }\n    }\n\n    getNodeFromQuestionOrSection(item: QuestionSection | QAQuestion, sectionNumber: string) {\n        let def: ITreeNode = {\n            id: item.id,\n            icon: undefined,\n            label: \"\",\n        };\n        if (item instanceof QAQuestion) {\n            def.icon = \"document\"\n            def.label = sectionNumber + \" \" + \"Question\";\n        }\n        else if (item instanceof QuestionSection) {\n            def.icon = \"folder-close\"\n            def.label = sectionNumber + \" \" + (item.name || \"Section\");\n            def.childNodes = item.content.map((it, ind) => this.getNodeFromQuestionOrSection(it, sectionNumber + \".\" + (ind + 1)))\n\n        }\n        return def;\n    }\n\n    generateITNodeTree(form: SurveyForm): ITreeNode[] {\n        let root: ITreeNode = {\n            id: 0,\n            hasCaret: true,\n            icon: \"folder-close\",\n            label: form.name,\n            isExpanded: true,\n            childNodes: form.content.map((it, ind) => this.getNodeFromQuestionOrSection(it, (ind + 1).toString()))\n        }\n        return [root];\n    }\n\n    addSectionToNodeTree(_nodePath: number[], section: QuestionSection) {\n        let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n        if (node.childNodes) {\n            let readablePath = getReadablePath(this.state.activeSectionPath);\n            if (readablePath) readablePath += \".\";\n            node.childNodes.push(this.getNodeFromQuestionOrSection(section, readablePath + (node.childNodes.length + 1).toString()))\n        }\n\n        return this.state;\n    }\n\n\n    deleteNodeFromNodeTree(_nodePath: number[], id: string) {\n        let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n        if (node.childNodes) {\n            let foundIndex = node.childNodes.findIndex(item => item.id === id);\n            if (foundIndex > -1) {\n                node.childNodes.splice(foundIndex, 1)\n            }\n        }\n        return this.state;\n    }\n\n    addQuestionToNodeTree(_nodePath: number[], section: QAQuestion) {\n        let node = Tree.nodeFromPath(_nodePath, this.state.treeNodes);\n        if (node.childNodes) {\n            let readablePath = getReadablePath(this.state.activeSectionPath);\n            if (readablePath) readablePath += \".\";\n            node.childNodes.push(this.getNodeFromQuestionOrSection(section, readablePath + (node.childNodes.length + 1).toString()))\n        }\n        return this.state;\n    }\n\n    handleChange(section: QuestionSection) {\n        this.setState((prevState: SurveyFormState) => {\n            return {\n                form: section,\n            }\n        }, () => {\n            if (this.props.onChange) this.props.onChange(this.state.form);\n        })\n    }\n\n    handleAddSection() {\n        this.setState((prevState: SurveyFormState) => {\n            let cloned = _.clone(prevState.form);\n            let toAddIn = SurveyForm_.questionOrSectionFromPath(this.state.activeSectionPath, [cloned]);\n            if (toAddIn instanceof QAQuestion) {\n                return {\n\n                }\n            }\n            let newsection = new QuestionSection();\n            toAddIn.addContent(new QuestionSection());\n            this.addSectionToNodeTree(this.state.activeSectionPath, newsection);\n            return {\n                ...this.state,\n                form: cloned\n            }\n        }, () => {\n            if (this.props.onChange) this.props.onChange(this.state.form);\n        })\n    }\n\n    handleAddQuestion() {\n        this.setState((prevState: SurveyFormState) => {\n            let cloned = _.clone(prevState.form);\n            let toAddIn = SurveyForm_.questionOrSectionFromPath(this.state.activeSectionPath, [cloned]);\n            if (toAddIn instanceof QAQuestion) {\n                return {\n\n                }\n            }\n            let q = new QAQuestion();\n            toAddIn.addContent(new QAQuestion());\n\n            this.addQuestionToNodeTree(this.state.activeSectionPath, q)\n\n            return {\n                ...this.state,\n                form: cloned,\n            }\n        }, () => {\n            if (this.props.onChange) this.props.onChange(this.state.form);\n        })\n    }\n    handleDeleteQuestionOrSection(deleteid: string) {\n        this.setState((prevState: SurveyFormState) => {\n            let cloned = _.clone(prevState.form);\n            cloned.deleteContent(deleteid);\n\n            this.deleteNodeFromNodeTree(this.state.activeSectionPath, deleteid)\n\n            return {\n                ...this.state,\n                form: cloned,\n            }\n        }, () => {\n            if (this.props.onChange) this.props.onChange(this.state.form);\n        })\n    }\n\n    handleToolbarItemClick(name: string) {\n        switch (name) {\n            case \"add-section\":\n                this.handleAddSection()\n                break;\n            case \"add-question\":\n                this.handleAddQuestion();\n                break;\n        }\n    }\n\n    handleQuestionUpdate(question: QAQuestion) {\n        this.setState((prevState: SurveyFormState) => {\n            let cloned = _.clone(prevState.form);\n            let foundQ = cloned.content.find(item => item.id === question.id);\n            if (foundQ && foundQ instanceof QAQuestion) {\n                foundQ.updateFromQuestion(question);\n            }\n            return {\n                form: cloned\n            }\n        }, () => {\n            if (this.props.onChange) this.props.onChange(this.state.form);\n        })\n    }\n\n    private forEachNode(nodes: ITreeNode[], callback: (node: ITreeNode) => void) {\n        if (nodes == null) {\n            return;\n        }\n\n        for (const node of nodes) {\n            callback(node);\n            if (node.childNodes)\n                this.forEachNode(node.childNodes, callback);\n        }\n    }\n\n    handleFormTreeNodeExpand(nodeData: ITreeNode) {\n        nodeData.isExpanded = true;\n        this.setState(this.state);\n\n    }\n\n    handleFormTreeNodeCollapse(nodeData: ITreeNode) {\n        nodeData.isExpanded = false;\n        this.setState(this.state);\n    }\n\n\n    handleFormTreeNodeClick(nodeData: ITreeNode, _nodePath: number[], e: React.MouseEvent<HTMLElement>) {\n        console.log(_nodePath);\n        const initiallySelected = !!nodeData.isSelected;\n        if (!e.shiftKey) {\n            this.forEachNode(this.state.treeNodes, n => (n.isSelected = false));\n        }\n        nodeData.isSelected = !initiallySelected;\n        let item = SurveyForm_.questionOrSectionFromPath(_nodePath, [this.state.form]);\n        console.log(item)\n        if (item instanceof QuestionSection) {\n            this.setState((prevState: SurveyFormState) => {\n\n                return {\n                    ...this.state,\n                    activeSection: item instanceof QuestionSection ? item : prevState.activeSection,\n                    activeSectionPath: _nodePath\n                }\n\n            })\n        }\n\n\n\n    }\n\n    render() {\n\n        return (\n            <Row>\n                <Toolbar handleItemClick={this.handleToolbarItemClick.bind(this)}></Toolbar>\n                <div className=\"container\">\n\n                    <div style={{ background: \"transparent\" }} className=\"sidebar\">\n                        <div className=\"sidebar-wrapper\">\n                            <FormTree handleNodeExpand={this.handleFormTreeNodeExpand.bind(this)} handleNodeCollapse={this.handleFormTreeNodeCollapse.bind(this)} handleNodeClick={this.handleFormTreeNodeClick.bind(this)} nodes={this.state.treeNodes} />\n                        </div>\n                    </div>\n                    <div className=\"content\">\n                        <SectionC handleDeleteChildSectionOrQuestion={this.handleDeleteQuestionOrSection.bind(this)} parentPath={this.state.activeSectionPath} handleQuestionChange={this.handleQuestionUpdate.bind(this)} section={this.state.activeSection} />\n                    </div>\n                    <Row style={{\n                        position: \"fixed\",\n                        height: \"60px\",\n                        bottom: 0,\n                        width: \"100%\",\n                        margin: \"0 auto\"\n                    }} className=\"fixed-footer\">\n\n\n\n                    </Row>\n                </div>\n            </Row>\n\n        )\n    }\n}\ninterface FormTreeState {\n}\ninterface FormTreeProps {\n    root: (QAQuestion|QuestionSection)[],\n    handleNodeClick?: (nodeData: ITreeNode, _nodePath: number[], e: React.MouseEvent<HTMLElement>) => void,\n    handleNodeCollapse?: (nodeData: ITreeNode) => void,\n    handleNodeExpand?: (nodeData: ITreeNode) => void,\n\n}\nexport class FormTree extends React.Component<FormTreeProps, FormTreeState>{\n    constructor(props: FormTreeProps) {\n        super(props);\n        this.state = {\n\n        }\n    }\n    private handleNodeClick = (nodeData: ITreeNode, _nodePath: number[], e: React.MouseEvent<HTMLElement>) => {\n        if (this.props.handleNodeClick) this.props.handleNodeClick(nodeData, _nodePath, e);\n    };\n\n    private handleNodeCollapse = (nodeData: ITreeNode) => {\n        if (this.props.handleNodeCollapse) this.props.handleNodeCollapse(nodeData);\n    };\n\n    private handleNodeExpand = (nodeData: ITreeNode) => {\n        if (this.props.handleNodeExpand) this.props.handleNodeExpand(nodeData);\n    };\n\n    render() {\n        return <Tree contents={this.props.nodes}\n            onNodeClick={this.handleNodeClick}\n            onNodeCollapse={this.handleNodeCollapse}\n            onNodeExpand={this.handleNodeExpand}\n            className={Classes.ELEVATION_0} />\n\n    }\n}\ninterface SectionCProps {\n    section: QuestionSection,\n    handleQuestionChange: (question: QAQuestion) => void,\n    parentPath: number[],\n    handleDeleteChildSectionOrQuestion: (deleteid: string) => void,\n}\ninterface SectionCState {\n}\nclass SectionC extends React.Component<SectionCProps, SectionCState>{\n    constructor(props: SectionCProps) {\n        super(props);\n        this.state = {\n        }\n    }\n\n    handleQuestionChange(q: QAQuestion) {\n        if (this.props.handleQuestionChange) this.props.handleQuestionChange(q);\n    }\n\n\n\n    render() {\n        let comp = null;\n        let readablePath = getReadablePath(this.props.parentPath);\n        if (readablePath) readablePath += \".\";\n        comp = this.props.section.content.map((item, index) => {\n            if (item instanceof QAQuestion) {\n                return <QuestionButton questionId={item.id} handleDeletion={this.props.handleDeleteChildSectionOrQuestion} path={readablePath + (index + 1)} key={item.id} isExpanded={false}>\n                    <DPFormItem onChange={this.handleQuestionChange.bind(this)} question={item} />\n                </QuestionButton>\n            }\n            else if (item instanceof QuestionSection) {\n                return <SectionButton handleDeletion={this.props.handleDeleteChildSectionOrQuestion} sectionId={item.id} path={readablePath + (index + 1)} key={item.id} onClick={() => console.log(\"Sdf\")}></SectionButton>\n            }\n        })\n        return (\n            <ButtonGroup fill vertical>\n                {comp}\n\n            </ButtonGroup>\n\n        )\n    }\n}\ninterface QuestionButtonProps {\n    questionId: string,\n    isExpanded: boolean,\n    children: ReactNode,\n    path?: string,\n    handleDeletion: (id: string) => void,\n}\nconst QuestionButton = (props: QuestionButtonProps) => {\n    const [isExpanded, setIsExpanded] = useState(false);\n    return (\n        <ButtonGroup className=\"bp3-dark\" style={{ paddingBottom: \"20px\" }} fill vertical>\n            <ButtonGroup>\n                <Button_B style={{ height: 50 }} onClick={() => setIsExpanded(!isExpanded)} alignText={\"left\"} rightIcon={isExpanded ? \"chevron-up\" : \"chevron-down\"}><Badge color=\"secondary\">Q</Badge> <span>{props.path + \" Question\"} </span></Button_B>\n                <Button_B onClick={() => props.handleDeletion(props.questionId)} style={{ height: 50, width: 20 }} alignText=\"left\" rightIcon={\"cross\"} />\n            </ButtonGroup>\n            <Collapse keepChildrenMounted={false} isOpen={isExpanded}>\n                {props.children}\n            </Collapse>\n        </ButtonGroup>\n    )\n}\n\ninterface SectionButtonProps {\n    sectionId: string,\n    onClick: (e: React.MouseEvent) => void,\n    path?: string,\n    handleDeletion: (id: string) => void\n\n}\nconst SectionButton = (props: SectionButtonProps) => {\n    return (\n        <ButtonGroup className=\"bp3-dark\" style={{ paddingBottom: \"20px\" }} fill >\n            <Button_B style={{ height: 50 }} alignText=\"left\" onClick={props.onClick} rightIcon={\"folder-open\"}><Badge color=\"secondary\">S</Badge> <span>{props.path + \" Section\"} </span></Button_B>\n            <Button_B onClick={() => props.handleDeletion(props.sectionId)} style={{ height: 50, width: 20 }} alignText=\"left\"  rightIcon={\"cross\"} />\n\n        </ButtonGroup>\n    )\n}\n\n\n\n\nfunction getReadablePath(nu: number[]) {\n    return nu.slice(1).map(item => item + 1).join(\".\");\n\n}\ninterface EditViewProps{\n\n}\n\ninterface EditViewState{\n\n}\n\nclass EditView extends React.Component<EditViewProps, EditViewState>{\n    constructor(props: EditViewProps){\n        super(props);\n        this.state = {\n\n        }\n    }\n    private handleSectionAdd(){\n\n    }\n    private handleQuestionAdd(){\n\n    }\n    private handleSectionRemove(){\n\n    }\n    private handleQuestionRemove(){\n\n    }\n    private handleMoveItem(previousPath:number[], newPath:number[]){\n\n    }\n    render(){\n        return (\n            <></>\n        );\n    }\n    \n}"]},"metadata":{},"sourceType":"module"}